# Kafka
## Kafka 란 무엇인가요 ?
Kafka 란 고성능 파이프라인, 스트리밍 분석, 데이터 통합 및 미션 크리티컬 애플리케이션을 위한 오픈 소스 분산 이벤트 스트리밍 플랫폼 입니다.

## Kafka 사용처는 어떻게 되나요 ?

- 증권 거래소 등 **실시간 데이터 처리**
- 물류 등 **실시간 추적 모니터링**
- 대용량 센서 **데이터 분석**
- **데이터 플랫폼, 이벤트 중심 아키텍처 및 MSA 의 기반**
- 메시지 지향 미들웨어로 메시지 브로커의 역할

## 이벤트 스트리밍 플랫폼?
스트리밍 플랫폼은 데이터 스트림을 읽고 쓰고 저장하고 처리하는 역할을 가진 시스템을 의미한다. <br>
즉, **이벤트 스트리밍 플랫폼이란 이벤트에 대한 데이터 스트림을 읽고 쓰노 저장하고 처리하는 역할을 가진 시스템이다.**

Kafka 는 3가지 주요 기능을 이용하여 이벤트 스트리밍을 구현할 수 있다.

- 이벤트 스트림을 지속적으로 발행, 구독한다.
- 이벤트 스트림을 원하는 만큼 내구성있고 안정성 있게 제공 한다.
- 이벤트 스트림 발생시 소급하여 처리한다.

## Kafka 의 장점은 무엇인가요 ?

- 대용량 트래픽에 특화되어 있어 TPS 가 우수하다는 장점이있습니다.
- 분산 처리에 효과적으로 병렬처리, 확장에 용이합니다.
- 파일 시스템에 메시지를 저장함으로 영속성이 보장됩니다.
- 다중 Producer, Consumer 로 인해 상호 관섭없이 메시지를 읽고 쓰기가 가능하다.
- Batch 기능을 제공하여 동시 처리가 가능하다.
- Producer 의 경우 일정 크기만큼 메시지를 모아서 전송이 가능하다.
- Consumer 의 경우 최소 크기만큼 메시지를 모아서 읽기가 가능하다.
- Replication 기능을 이용할 경우 데이터를 복제하여 분산 저장하게 되고 장애 발생시 Partition 단위로 Fail over 가 실행된다.

## 주요 개념 및 용어

- Kafka Cluster : Kafka 의 브로커들의 모임 입니다. (확장, 고가용성을 위해 브로커를 클러스터링 한다.)
- Broker : 각각의 Kafka 서버라고 볼수 있다. 동일 노드에 여러 브로커로 구성하는게 가능하다.
- Zookeeper : Kafka Cluster 정보와 분산 처리 관리를 위한 메타 데이터를 저장한다. 카프카 실행전에 실행되어 있어야 한다.
- Producer : 이벤트를 발행, 생산하는 주체
- Consumer : 이벤트를 구독, 소비하는 주체

### Topic, Partition, Offset

- Kafka 에 저장되는 메시지는 Topic 으로 분류되며, Topic 은 여러개의 Partition 으로 나눠진다.
- Topic 은 메시지를 나누는 기준이다.
- Partition 은 메시지를 저장하는 물리적인 파일이다.
- 한개의 Topic 은 한개 이상의 Partition 을 가지고 있다.
- Partition 은 메시지 추가만 가능한 파일이다.
- Offset 은 Partition 내 각 메시지의 저장된 상대적 위치 이다.
- Producer 가 넣은 메시지는 Partition 맨 뒤에뒤에 된다.
- Consumer 는 Offset 기준으로 마지막 커밋 시점부터 순서대로 메시지를 읽어와 처리한다.
- Partition 의 메시지 파일은 처리 후에도 저장되어 있다가, 설정에 따라 일정 시간 뒤에 삭제 된다.

### Producer 

- Producer 는 메시지 발행, 생산하는 주체이다.
- Producer 는 메시지 발행, 생산시 Topic 을 지정한다.
- Partition 은 Round robin 방식이나 번호를 지정하여 넣을수 있다.
- 같은 키를 가진 메시지는 같은 Partition 에 순서대로 저장된다.

### Consumer

- Consumer 는 메시지 구독, 소비하는 주체이다.
= Consumer Group 은 메시지를 소비하는 논리적인 그룹이다.
- Topic 의 Partition 은 Consumer Group 과 1:N 의 매칭 관계를 가진다.
- Topic 의 Partition 은 동일한 Consumer Group 내 한개의 Consumer 만 연결이 가능하다.
- 특정 Consumer 에 문제가 발생하였을 경우, Fail Over 를 통한 리벨런싱이 가능하다.
- 보통 Partition 과 Consumer 는 1:1 매칭 하는것이 좋다.

## Kafka 궁금증 목록

- 대용량 TPS 를 감당하기 위한 최적의 환경은 무엇인가 ?
- 병렬 처리와 확장을 용이하게 늘릴수 있는 방법은 ?
- 파일 시스템에 메시지를 저장하는데 어떤 형식으로 저장되는가 ?
- Kafka Cluster 의 Broker 는 몇개가 적당한가 ? 
- Zookeeper 가 죽었을 경우에 대한 대비책은 ?
- kafka 이벤트 복구 방법은 ?
- 파일 시스템에 메시지를 저장한다는데, Partition 으로 나누어진 물리 적인 파일로 저장하는가 ?
- Consumer 문제 발생시 리벨런싱의 자동화가 가능한가 ?